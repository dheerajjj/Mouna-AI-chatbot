<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Integration - Mouna AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0d7b8a 0%, #4a0e6b 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1a202c;
            line-height: 1.6;
        }
        
        /* Add subtle grain overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.02"><circle cx="30" cy="30" r="1"/></g></g></svg>');
            opacity: 0.5;
            pointer-events: none;
            z-index: 0;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1.5rem 0;
            position: relative;
            z-index: 10;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo img {
            width: 40px;
            height: 40px;
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }
        
        .logo-name {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e293b;
            letter-spacing: -0.02em;
        }
        
        .logo-tagline {
            font-size: 0.75rem;
            font-weight: 500;
            color: #64748b;
            letter-spacing: 0.02em;
            margin-top: -2px;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .page-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card:hover {
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.15), 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px) scale(1.02);
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .guide-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .guide-box::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        .guide-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .guide-steps {
            list-style: none;
            padding-left: 0;
        }
        
        .guide-steps li {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0.75rem;
            color: #475569;
        }
        
        .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .code-container {
            position: relative;
            margin: 1.5rem 0;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 12px;
            font-family: 'Fira Code', 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            overflow-x: auto;
            border: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .code-block .tag { color: #f59e0b; }
        .code-block .attr { color: #10b981; }
        .code-block .string { color: #3b82f6; }
        .code-block .comment { color: #6b7280; font-style: italic; }
        
        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .copy-btn.copied {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .main-copy-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            margin-top: 1.5rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .main-copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .api-key-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fef9e7 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            position: relative;
        }
        
        .api-key-box::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 2px;
        }
        
        .api-key-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dashboard-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .dashboard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        .preview-section {
            text-align: center;
            padding: 2rem 0;
        }
        
        .preview-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }
        
        /* Tenant selection styles */
        .tenant-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: end;
        }
        
        .tenant-dropdown-container {
            flex: 1;
        }
        
        .tenant-dropdown-container label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .tenant-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            transition: border-color 0.2s;
        }
        
        .tenant-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .create-tenant-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .create-tenant-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }
        
        .tenant-info {
            background: #f0f9ff;
            border: 1px solid #0284c7;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .tenant-info h4 {
            margin: 0 0 0.5rem 0;
            color: #0284c7;
            font-size: 0.9rem;
        }
        
        .tenant-details {
            font-size: 0.85rem;
            color: #374151;
        }
        
        .tenant-details strong {
            color: #1f2937;
        }
        
        /* Tenant explanation styles */
        .tenant-explanation {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .explanation-header {
            padding: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #4f46e5;
            transition: background-color 0.2s;
        }
        
        .explanation-header:hover {
            background: #f1f5f9;
        }
        
        .explanation-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
        }
        
        .explanation-arrow.rotated {
            transform: rotate(180deg);
        }
        
        .explanation-content {
            padding: 0 1rem 1rem 1rem;
            border-top: 1px solid #e2e8f0;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .explanation-content p {
            margin-bottom: 1rem;
            color: #64748b;
            line-height: 1.6;
        }
        
        .explanation-examples {
            margin: 1rem 0;
        }
        
        .example {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        .example i {
            color: #4f46e5;
            width: 20px;
            text-align: center;
        }
        
        .example div {
            flex: 1;
            color: #374151;
            font-size: 0.9rem;
        }
        
        .example strong {
            color: #1f2937;
        }
        
        .widget-mockup {
            max-width: 300px;
            margin: 2rem auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        /* Tenant Configuration Preview Styles */
        .tenant-config-examples {
            margin: 2rem 0;
        }
        
        .config-examples-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .config-examples-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .config-examples-header p {
            color: #64748b;
            font-size: 1rem;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .config-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .config-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }
        
        .config-card.restaurant-config:hover {
            border-color: #f59e0b;
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.15);
        }
        
        .config-card.clinic-config:hover {
            border-color: #10b981;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.15);
        }
        
        .config-card.portfolio-config:hover {
            border-color: #8b5cf6;
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.15);
        }
        
        .config-card.ecommerce-config:hover {
            border-color: #ef4444;
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.15);
        }
        
        .config-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
            line-height: 1;
        }
        
        .config-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .config-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }
        
        .feature-tag {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(3, 105, 161, 0.2);
        }
        
        .restaurant-config .feature-tag {
            background: linear-gradient(135deg, #fef3c7 0%, #fef9e7 100%);
            color: #d97706;
            border-color: rgba(217, 119, 6, 0.2);
        }
        
        .clinic-config .feature-tag {
            background: linear-gradient(135deg, #d1fae5 0%, #f0fdf4 100%);
            color: #059669;
            border-color: rgba(5, 150, 105, 0.2);
        }
        
        .portfolio-config .feature-tag {
            background: linear-gradient(135deg, #ede9fe 0%, #f5f3ff 100%);
            color: #7c3aed;
            border-color: rgba(124, 58, 237, 0.2);
        }
        
        .ecommerce-config .feature-tag {
            background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%);
            color: #dc2626;
            border-color: rgba(220, 38, 38, 0.2);
        }
        
        .config-description {
            font-size: 0.9rem;
            color: #64748b;
            text-align: center;
            font-style: italic;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        
        .config-action {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            margin-top: auto;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .config-card:hover .config-action {
            opacity: 1;
            transform: translateY(0);
        }
        
        .restaurant-config:hover .config-action {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .clinic-config:hover .config-action {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .portfolio-config:hover .config-action {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .ecommerce-config:hover .config-action {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .preview-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .preview-btn.primary {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .preview-btn.secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .nav-container {
                padding: 0 1rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .preview-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .preview-btn {
                width: 100%;
                max-width: 300px;
            }
        }
        
        /* Tenant filter styles */
        .tenant-filter-container {
            position: relative;
            width: 100%;
        }
        
        .tenant-filter {
            width: 100%;
            padding: 0.75rem 1rem;
            padding-right: 2.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            transition: border-color 0.2s;
        }
        
        .tenant-filter:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .tenant-filter::placeholder {
            color: #9ca3af;
        }
        
        .clear-filter-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        
        .clear-filter-btn:hover {
            color: #374151;
            background: #f3f4f6;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="/images/logo.png" alt="Mouna AI Logo">
                <div class="logo-text">
                    <div class="logo-name">Mouna</div>
                    <div class="logo-tagline">AI ASSISTANT</div>
                </div>
            </div>
            <a href="/welcome-dashboard" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </a>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Widget Integration</h1>
            <p class="page-subtitle">Get your AI chatbot live on your website in just a few simple steps. No technical expertise required!</p>
        </div>

        <!-- Quick Integration Guide -->
        <div class="guide-box">
            <div class="guide-title">
                <i class="fas fa-clipboard-list"></i>
                Quick Integration Guide
            </div>
            <ol class="guide-steps">
                <li><span class="step-number">1</span>Copy the integration code below</li>
                <li><span class="step-number">2</span>Replace YOUR_API_KEY with your actual API key</li>
                <li><span class="step-number">3</span>Paste it before the &lt;/body&gt; tag on your website</li>
            </ol>
        </div>

        <!-- Tenant Selection Card (for paid plans) -->
        <div class="card" id="tenant-selection-card" style="display: none;">
            <div class="card-icon">
                <i class="fas fa-building"></i>
            </div>
            <h2 class="card-title">Tenant Configuration</h2>
            <p style="color: #64748b; margin-bottom: 1rem;">Select or create a tenant for your widget integration:</p>
            
            <div class="tenant-explanation">
                <div class="explanation-header" onclick="toggleTenantExplanation()">
                    <i class="fas fa-question-circle"></i>
                    <span>What is a tenant?</span>
                    <i class="fas fa-chevron-down explanation-arrow" id="explanation-arrow"></i>
                </div>
                <div class="explanation-content" id="explanation-content" style="display: none;">
                    <p><strong>Think of a tenant as a separate chatbot setup for each client or website:</strong></p>
                    <div class="explanation-examples">
                        <div class="example">
                            <i class="fas fa-utensils"></i>
                            <div>
                                <strong>Restaurant Client:</strong> Chatbot knows their menu, hours, booking system
                            </div>
                        </div>
                        <div class="example">
                            <i class="fas fa-stethoscope"></i>
                            <div>
                                <strong>Clinic Client:</strong> Chatbot handles appointments, medical info, clinic hours
                            </div>
                        </div>
                        <div class="example">
                            <i class="fas fa-briefcase"></i>
                            <div>
                                <strong>Your Portfolio:</strong> Chatbot shows your services, portfolio, contact info
                            </div>
                        </div>
                    </div>
                    <p><strong>Each tenant gets:</strong> Custom colors, logo, welcome messages, separate analytics, and different features enabled.</p>
                </div>
            </div>
            
            <div class="tenant-controls">
                <div class="tenant-dropdown-container">
                    <label for="tenant-filter">Search Tenants:</label>
                    <div class="tenant-filter-container">
                        <input type="text" id="tenant-filter" class="tenant-filter" placeholder="Filter by name or type..." />
                        <button id="clear-filter-btn" class="clear-filter-btn" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <label for="tenant-select" style="margin-top: 1rem;">Select Tenant:</label>
                    <select id="tenant-select" class="tenant-select">
                        <option value="">Loading tenants...</option>
                    </select>
                </div>
                
                <button id="create-tenant-btn" class="create-tenant-btn">
                    <i class="fas fa-plus"></i>
                    Create New Tenant
                </button>
                
            </div>
            
            <div id="selected-tenant-info" class="tenant-info" style="display: none;">
                <h4>Selected Tenant Details:</h4>
                <div id="tenant-details"></div>
            </div>
        </div>

        <!-- Integration Code Card -->
        <div class="card">
            <div class="card-icon">
                <i class="fas fa-code"></i>
            </div>
            <h2 class="card-title">Integration Code</h2>
            <p style="color: #64748b; margin-bottom: 1.5rem;" id="integration-description">Copy this code to add the chatbot to your website:</p>
            
            <div class="code-container">
                <div class="code-block" id="widget-snippet">
<span class="tag">&lt;script</span> <span class="attr">src</span>=<span class="string">"https://mouna-ai-chatbot-production.up.railway.app/widget-fixed.js"</span><br>
        <span class="attr">data-api-key</span>=<span class="string">"YOUR_API_KEY_HERE"</span><br>
        <span class="attr">data-primary-color</span>=<span class="string">"#667eea"</span><br>
        <span class="attr">data-position</span>=<span class="string">"bottom-right"</span><span class="tag">&gt;&lt;/script&gt;</span>
                </div>
                <button class="copy-btn" onclick="copyCode('widget-snippet', this)">
                    <i class="fas fa-copy"></i>
                    Copy
                </button>
            </div>
            
            <button class="main-copy-btn" onclick="copyCode('widget-snippet', this)">
                <i class="fas fa-copy"></i>
                Copy Integration Code
            </button>
        </div>

        <!-- API Key Information -->
        <div class="api-key-box">
            <div class="api-key-title">
                <i class="fas fa-key"></i>
                Where to find your API Key
            </div>
            <p style="color: #92400e; margin-bottom: 1rem;">Your API key is required to authenticate your chatbot widget. Here's how to get it:</p>
            <ul style="color: #92400e; margin-left: 1.5rem;">
                <li>Navigate to your dashboard</li>
                <li>Look for the "API Configuration" section</li>
                <li>Copy your unique API key</li>
                <li>Replace "YOUR_API_KEY" in the code above</li>
            </ul>
            <a href="/welcome-dashboard" class="dashboard-btn">
                <i class="fas fa-external-link-alt"></i>
                Go to Dashboard
            </a>
        </div>

        <!-- Example Integration -->
        <div class="card">
            <div class="card-icon">
                <i class="fas fa-file-code"></i>
            </div>
            <h2 class="card-title">Example Integration</h2>
            <p style="color: #64748b; margin-bottom: 1.5rem;">Here's a complete example showing how to integrate the widget into your HTML page:</p>
            
            <div class="code-container">
                <div class="code-block" id="example-code">
<span class="tag">&lt;!DOCTYPE html&gt;</span><br>
<span class="tag">&lt;html</span> <span class="attr">lang</span>=<span class="string">"en"</span><span class="tag">&gt;</span><br>
<span class="tag">&lt;head&gt;</span><br>
    <span class="tag">&lt;meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span><span class="tag">&gt;</span><br>
    <span class="tag">&lt;title&gt;</span>My Website<span class="tag">&lt;/title&gt;</span><br>
<span class="tag">&lt;/head&gt;</span><br>
<span class="tag">&lt;body&gt;</span><br>
    <span class="tag">&lt;h1&gt;</span>Welcome to My Website<span class="tag">&lt;/h1&gt;</span><br>
    <span class="tag">&lt;p&gt;</span>Your website content goes here...<span class="tag">&lt;/p&gt;</span><br>
    <br>
    <span class="comment">&lt;!-- Add the chatbot widget just before closing body tag --&gt;</span><br>
    <span class="tag">&lt;script</span> <span class="attr">src</span>=<span class="string">"https://mouna-ai-chatbot-production.up.railway.app/widget-fixed.js"</span><br>
            <span class="attr">data-api-key</span>=<span class="string">"YOUR_API_KEY_HERE"</span><span class="tag">&gt;&lt;/script&gt;</span><br>
<span class="tag">&lt;/body&gt;</span><br>
<span class="tag">&lt;/html&gt;</span>
                </div>
                <button class="copy-btn" onclick="copyCode('example-code', this)">
                    <i class="fas fa-copy"></i>
                    Copy
                </button>
            </div>
        </div>

        <!-- Preview Widget Section -->
        <div class="card preview-section">
            <div class="card-icon">
                <i class="fas fa-eye"></i>
            </div>
            <h2 class="card-title">Preview Your Widget & Tenant Configurations</h2>
            <p style="color: #64748b; margin-bottom: 2rem;">See how different tenant configurations enable specialized features like bookings, orders, and appointments.</p>
            
            <div class="tenant-config-examples">
                <div class="config-examples-header">
                    <h3>🎯 Tenant Configurations - Real Business Examples</h3>
                    <p>Each tenant can be configured with specialized features for different business types:</p>
                </div>
                
                <div class="config-grid">
                    <div class="config-card restaurant-config" onclick="previewTenantConfig('restaurant')">
                        <div class="config-icon">🍽️</div>
                        <div class="config-content">
                            <h4>Restaurant Tenant</h4>
                            <div class="config-features">
                                <span class="feature-tag">Table Reservations</span>
                                <span class="feature-tag">Menu Display</span>
                                <span class="feature-tag">Order Taking</span>
                                <span class="feature-tag">Hours & Location</span>
                            </div>
                            <p class="config-description">"Book a table for 4 people at 7 PM" - Handles reservations with date/time picker</p>
                        </div>
                        <div class="config-action">Click to Preview</div>
                    </div>
                    
                    <div class="config-card clinic-config" onclick="previewTenantConfig('clinic')">
                        <div class="config-icon">🏥</div>
                        <div class="config-content">
                            <h4>Medical Clinic Tenant</h4>
                            <div class="config-features">
                                <span class="feature-tag">Appointment Booking</span>
                                <span class="feature-tag">Doctor Availability</span>
                                <span class="feature-tag">Service Info</span>
                                <span class="feature-tag">Insurance Check</span>
                            </div>
                            <p class="config-description">"Schedule an appointment with Dr. Smith" - Manages medical appointments</p>
                        </div>
                        <div class="config-action">Click to Preview</div>
                    </div>
                    
                    <div class="config-card portfolio-config" onclick="previewTenantConfig('portfolio')">
                        <div class="config-icon">💼</div>
                        <div class="config-content">
                            <h4>Portfolio/Agency Tenant</h4>
                            <div class="config-features">
                                <span class="feature-tag">Service Inquiry</span>
                                <span class="feature-tag">Project Quotes</span>
                                <span class="feature-tag">Portfolio Showcase</span>
                                <span class="feature-tag">Contact Forms</span>
                            </div>
                            <p class="config-description">"I need a website for my business" - Qualifies leads and showcases work</p>
                        </div>
                        <div class="config-action">Click to Preview</div>
                    </div>
                    
                    <div class="config-card ecommerce-config" onclick="previewTenantConfig('ecommerce')">
                        <div class="config-icon">🛍️</div>
                        <div class="config-content">
                            <h4>E-commerce Store Tenant</h4>
                            <div class="config-features">
                                <span class="feature-tag">Product Search</span>
                                <span class="feature-tag">Order Tracking</span>
                                <span class="feature-tag">Support Tickets</span>
                                <span class="feature-tag">Return Process</span>
                            </div>
                            <p class="config-description">"Where is my order #12345?" - Handles customer support and orders</p>
                        </div>
                        <div class="config-action">Click to Preview</div>
                    </div>
                </div>
            </div>
            
            <div class="preview-actions">
                <button class="preview-btn primary" onclick="previewWidget()">
                    <i class="fas fa-play-circle"></i>
                    Preview Basic Widget
                </button>
                <button class="preview-btn secondary" onclick="showTenantGuide()">
                    <i class="fas fa-lightbulb"></i>
                    Tenant Setup Guide
                </button>
            </div>
            
            <div class="widget-mockup">
                <img src="data:image/svg+xml,%3csvg width='300' height='400' xmlns='http://www.w3.org/2000/svg'%3e%3cg%3e%3crect width='300' height='400' fill='%23f3f4f6'/%3e%3crect x='20' y='20' width='260' height='40' rx='8' fill='%23667eea'/%3e%3ctext x='150' y='45' text-anchor='middle' fill='white' font-family='Inter, sans-serif' font-size='16' font-weight='600'%3eYour Website%3c/text%3e%3crect x='20' y='80' width='260' height='240' fill='white'/%3e%3ctext x='150' y='210' text-anchor='middle' fill='%23374151' font-family='Inter, sans-serif' font-size='14'%3eWebsite Content%3c/text%3e%3ccircle cx='260' cy='360' r='25' fill='%23667eea'/%3e%3ctext x='260' y='367' text-anchor='middle' fill='white' font-family='Inter, sans-serif' font-size='16'%3e💬%3c/text%3e%3c/g%3e%3c/svg%3e" alt="Widget Preview" style="width: 100%;">
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span>Copied!</span>
    </div>

    <script>
        function copyCode(elementId, button) {
            const codeElement = document.getElementById(elementId);
            const text = codeElement.innerText || codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show toast notification
                const toast = document.getElementById('toast');
                toast.classList.add('show');
                
                // Update button state
                const originalContent = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                button.classList.add('copied');
                
                // Reset after 2 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    button.innerHTML = originalContent;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Show success toast
                const toast = document.getElementById('toast');
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            });
        }
        
        function previewWidget() {
            // Create a preview modal with actual widget
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;
            
            const previewContainer = document.createElement('div');
            previewContainer.style.cssText = `
                width: 90%;
                max-width: 800px;
                height: 80%;
                background: #f3f4f6;
                border-radius: 12px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            `;
            
            // Determine if we have a selected tenant and its type
            const tenantTitle = selectedTenant ? `🎯 ${selectedTenant.name} Preview` : '🌐 Your Website Preview';
            const tenantType = selectedTenant ? selectedTenant.type : null;
            
            const header = document.createElement('div');
            header.style.cssText = `
                background: ${selectedTenant ? getTenantColor(tenantType) : '#667eea'};
                color: white;
                padding: 1rem 2rem;
                font-family: Inter, sans-serif;
                font-weight: 600;
                font-size: 1.1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            `;
            header.innerHTML = `
                <span>${tenantTitle}</span>
                <button onclick="this.closest('.preview-modal').remove()" style="
                    background: none;
                    border: none;
                    color: white;
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: background 0.2s;
                " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">×</button>
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                padding: 2rem;
                height: calc(100% - 80px);
                background: white;
                position: relative;
                overflow-y: auto;
            `;
            
            // Generate tenant-specific content
            const tenantContent = generateTenantPreviewContent(selectedTenant);
            
            content.innerHTML = tenantContent;
            
            previewContainer.appendChild(header);
            previewContainer.appendChild(content);
            modal.appendChild(previewContainer);
            modal.className = 'preview-modal';
            document.body.appendChild(modal);
            
            // Load the actual widget with test API key
            fetch('/test-api-key')
                .then(response => response.json())
                .then(data => {
                    if (data.apiKey) {
                        // Remove any existing widget first to prevent conflicts
                        const existingWidget = document.querySelector('.ai-chatbot-widget');
                        if (existingWidget) {
                            existingWidget.remove();
                        }
                        
                        // Create and inject the widget script
                        const script = document.createElement('script');
                        script.src = '/widget-fixed.js';
                        script.setAttribute('data-api-key', data.apiKey);
                        script.setAttribute('data-primary-color', '#667eea');
                        script.setAttribute('data-position', 'bottom-right');
                        
                        // Ensure widget has higher z-index than modal
                        script.onload = function() {
                            setTimeout(() => {
                                const widgetElements = document.querySelectorAll('.ai-chatbot-widget, .ai-chatbot-widget *');
                                widgetElements.forEach(el => {
                                    if (el.style) {
                                        el.style.zIndex = Math.max(parseInt(el.style.zIndex) || 0, 10001);
                                    }
                                });
                                
                                // Ensure input field is focusable and interactive
                                const inputField = document.querySelector('#chatbot-input-field');
                                if (inputField) {
                                    inputField.style.pointerEvents = 'auto';
                                    inputField.style.userSelect = 'text';
                                    inputField.removeAttribute('disabled');
                                    inputField.removeAttribute('readonly');
                                    
                                    // Force focus capability
                                    inputField.tabIndex = 0;
                                    
                                    console.log('Widget input field prepared for interaction');
                                }
                                
                                // Auto-open the widget for preview
                                if (window.AIChatbotWidget && typeof window.AIChatbotWidget.open === 'function') {
                                    setTimeout(() => {
                                        window.AIChatbotWidget.open();
                                    }, 500);
                                }
                            }, 1000);
                        };
                        
                        document.head.appendChild(script);
                        
                        // Clean up script when modal is closed
                        modal.addEventListener('click', function(e) {
                            if (e.target === modal) {
                                modal.remove();
                                // Remove widget if it exists
                                const existingWidget = document.querySelector('.ai-chatbot-widget');
                                if (existingWidget) {
                                    existingWidget.remove();
                                }
                                // Clean up global widget object
                                if (window.AIChatbotWidget) {
                                    delete window.AIChatbotWidget;
                                }
                            }
                        });
                        
                        // Add instructions for better user experience
                        content.innerHTML += '<div style="background: #e0f2fe; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #0284c7;"><strong>💡 Tip:</strong> The chatbot will automatically open in a few seconds. You can interact with it just like on a real website - click the input field to type your message!</div>';
                        
                    } else {
                        content.innerHTML += '<div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #f59e0b;"><strong>Note:</strong> Widget preview requires API configuration. Please set up your API key first.</div>';
                    }
                })
                .catch(error => {
                    console.error('Error loading preview:', error);
                    content.innerHTML += '<div style="background: #fef2f2; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #ef4444;"><strong>Error:</strong> Could not load widget preview. Please try again later.</div>';
                });
        }
        
        // Global state
        let userApiKey = null;
        let userSubscription = null;
        let tenants = [];
        let allTenants = []; // Store all tenants for filtering
        let selectedTenant = null;
        
        // Populate tenant dropdown
        function populateTenantDropdown() {
            const tenantSelect = document.getElementById('tenant-select');
            tenantSelect.innerHTML = '<option value="">Select a tenant...</option>';
            
            tenants.forEach(tenant => {
                const option = document.createElement('option');
                option.value = tenant.tenantId;
                option.textContent = `${tenant.name} (${tenant.type})`;
                tenantSelect.appendChild(option);
            });
        }
        
        // Filter tenants based on search input
        function filterTenants() {
            const filterInput = document.getElementById('tenant-filter');
            const clearButton = document.getElementById('clear-filter-btn');
            const searchTerm = filterInput.value.toLowerCase().trim();
            
            // Show/hide clear button
            clearButton.style.display = searchTerm ? 'flex' : 'none';
            
            if (!searchTerm) {
                // No filter - show all tenants
                tenants = [...allTenants];
            } else {
                // Filter tenants by name or type
                tenants = allTenants.filter(tenant => 
                    tenant.name.toLowerCase().includes(searchTerm) ||
                    tenant.type.toLowerCase().includes(searchTerm)
                );
            }
            
            // Update dropdown
            populateTenantDropdown();
            
            // If current selection is no longer visible, clear it
            if (selectedTenant && !tenants.find(t => t.tenantId === selectedTenant.tenantId)) {
                selectedTenant = null;
                document.getElementById('selected-tenant-info').style.display = 'none';
                document.getElementById('tenant-select').value = '';
                updateIntegrationCode();
            }
        }
        
        // Clear filter
        function clearFilter() {
            const filterInput = document.getElementById('tenant-filter');
            const clearButton = document.getElementById('clear-filter-btn');
            
            filterInput.value = '';
            clearButton.style.display = 'none';
            
            // Reset to show all tenants
            tenants = [...allTenants];
            populateTenantDropdown();
            
            // Re-select current tenant if it exists
            if (selectedTenant) {
                document.getElementById('tenant-select').value = selectedTenant.tenantId;
            }
        }
        
        // Load user subscription and tenant data
        async function loadUserData() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    console.log('No auth token found');
                    return;
                }
                
                // Load user profile and subscription
                const profileResponse = await fetch('/api/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (profileResponse.ok) {
                    const { user } = await profileResponse.json();
                    userApiKey = user.apiKey;
                    userSubscription = user.subscription;
                    
                    console.log('User subscription:', userSubscription);
                    
                    // Show tenant selection for paid plans
                    if (userSubscription && userSubscription.plan !== 'free') {
                        document.getElementById('tenant-selection-card').style.display = 'block';
                        await loadTenants();
                        
                        // Update integration guide
                        updateIntegrationGuide(true);
                    } else {
                        // Free plan - use default integration
                        updateIntegrationCode();
                        updateIntegrationGuide(false);
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }
        
        // Load user tenants
        async function loadTenants() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/tenant/list', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const rawTenants = data.tenants || [];
                    
                    // Filter out debug tenants client-side (additional protection)
                    allTenants = rawTenants.filter(tenant => {
                        const debugPatterns = [
                            /debug.*test.*tenant/i,
                            /test.*debug.*tenant/i,
                            /debug.*tenant/i,
                            /test.*tenant.*debug/i
                        ];
                        
                        const hasDebugName = debugPatterns.some(pattern => pattern.test(tenant.name));
                        const hasDebugDescription = tenant.description && /debug.*tenant.*for.*testing/i.test(tenant.description);
                        
                        return !hasDebugName && !hasDebugDescription;
                    });
                    
                    tenants = [...allTenants]; // Initialize filtered tenants
                    
                    console.log(`✅ Loaded ${allTenants.length} valid tenants (filtered out debug tenants)`);
                    
                    // Populate tenant dropdown
                    populateTenantDropdown();
                    
                    // Auto-select first tenant if available
                    if (tenants.length > 0) {
                        selectTenant(tenants[0]);
                        document.getElementById('tenant-select').value = tenants[0].tenantId;
                    } else {
                        // Show helpful message if no tenants
                        showNoTenantsMessage();
                    }
                } else {
                    console.error('Failed to load tenants:', response.status);
                    showTenantLoadError('Failed to load tenants. Please refresh the page.');
                }
            } catch (error) {
                console.error('Error loading tenants:', error);
                showTenantLoadError('Network error loading tenants. Please check your connection.');
            }
        }
        
        // Select a tenant
        function selectTenant(tenant) {
            selectedTenant = tenant;
            
            // Update tenant details display
            const tenantDetails = document.getElementById('tenant-details');
            tenantDetails.innerHTML = `
                <p><strong>Name:</strong> ${tenant.name}</p>
                <p><strong>Type:</strong> ${tenant.type}</p>
                <p><strong>Tenant ID:</strong> <code>${tenant.tenantId}</code></p>
                ${tenant.description ? `<p><strong>Description:</strong> ${tenant.description}</p>` : ''}
            `;
            
            document.getElementById('selected-tenant-info').style.display = 'block';
            
            // Update integration code
            updateIntegrationCode();
        }
        
        // Update integration code based on selected tenant
        function updateIntegrationCode() {
            const widgetSnippet = document.getElementById('widget-snippet');
            const exampleCode = document.getElementById('example-code');
            
            let apiKeyValue = userApiKey || 'YOUR_API_KEY';
            let tenantParam = '';
            
            // Add tenant parameter for paid plans with selected tenant
            if (selectedTenant) {
                tenantParam = `<br>        <span class="attr">data-tenant-id</span>=<span class="string">"${selectedTenant.tenantId}"</span>`;
            }
            
            // Update widget snippet
            widgetSnippet.innerHTML = `
<span class="tag">&lt;script</span> <span class="attr">src</span>=<span class="string">"https://mouna-ai-chatbot-production.up.railway.app/widget-fixed.js"</span><br>
        <span class="attr">data-api-key</span>=<span class="string">"${apiKeyValue}"</span>${tenantParam}<br>
        <span class="attr">data-primary-color</span>=<span class="string">"#667eea"</span><br>
        <span class="attr">data-position</span>=<span class="string">"bottom-right"</span><span class="tag">&gt;&lt;/script&gt;</span>
            `.trim();
            
            // Update example code
            const tenantExampleParam = selectedTenant ? `<br>            <span class="attr">data-tenant-id</span>=<span class="string">"${selectedTenant.tenantId}"</span>` : '';
            
            exampleCode.innerHTML = `
<span class="tag">&lt;!DOCTYPE html&gt;</span><br>
<span class="tag">&lt;html</span> <span class="attr">lang</span>=<span class="string">"en"</span><span class="tag">&gt;</span><br>
<span class="tag">&lt;head&gt;</span><br>
    <span class="tag">&lt;meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span><span class="tag">&gt;</span><br>
    <span class="tag">&lt;title&gt;</span>My Website<span class="tag">&lt;/title&gt;</span><br>
<span class="tag">&lt;/head&gt;</span><br>
<span class="tag">&lt;body&gt;</span><br>
    <span class="tag">&lt;h1&gt;</span>Welcome to My Website<span class="tag">&lt;/h1&gt;</span><br>
    <span class="tag">&lt;p&gt;</span>Your website content goes here...<span class="tag">&lt;/p&gt;</span><br>
    <br>
    <span class="comment">&lt;!-- Add the chatbot widget just before closing body tag --&gt;</span><br>
    <span class="tag">&lt;script</span> <span class="attr">src</span>=<span class="string">"https://mouna-ai-chatbot-production.up.railway.app/widget-fixed.js"</span><br>
            <span class="attr">data-api-key</span>=<span class="string">"${apiKeyValue}"</span>${tenantExampleParam}<span class="tag">&gt;&lt;/script&gt;</span><br>
<span class="tag">&lt;/body&gt;</span><br>
<span class="tag">&lt;/html&gt;</span>
            `.trim();
        }
        
        // Update integration guide based on plan type
        function updateIntegrationGuide(isPaidPlan) {
            const guideSteps = document.querySelector('.guide-steps');
            const integrationDescription = document.getElementById('integration-description');
            
            if (isPaidPlan) {
                integrationDescription.textContent = 'Copy this tenant-specific code to add the chatbot to your website:';
                
                guideSteps.innerHTML = `
                    <li><span class="step-number">1</span>Select or create a tenant above</li>
                    <li><span class="step-number">2</span>Copy the tenant-specific integration code below</li>
                    <li><span class="step-number">3</span>Paste it before the &lt;/body&gt; tag on your website</li>
                    <li><span class="step-number">4</span>Customize tenant settings in your dashboard</li>
                `;
            } else {
                integrationDescription.textContent = 'Copy this code to add the chatbot to your website:';
                
                guideSteps.innerHTML = `
                    <li><span class="step-number">1</span>Copy the integration code below</li>
                    <li><span class="step-number">2</span>Replace YOUR_API_KEY with your actual API key</li>
                    <li><span class="step-number">3</span>Paste it before the &lt;/body&gt; tag on your website</li>
                `;
            }
        }
        
        // Toggle tenant explanation
        function toggleTenantExplanation() {
            const content = document.getElementById('explanation-content');
            const arrow = document.getElementById('explanation-arrow');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.classList.add('rotated');
            } else {
                content.style.display = 'none';
                arrow.classList.remove('rotated');
            }
        }
        
        // Create new tenant
        async function createNewTenant() {
            const tenantName = prompt('Enter tenant name:', 'Client Website');
            if (!tenantName) return;
            
            const tenantDescription = prompt('Enter tenant description (optional):', '');
            
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/tenant', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: tenantName,
                        description: tenantDescription,
                        type: 'client'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`Tenant "${data.tenant.name}" created successfully!`);
                    
                    // Reload tenants and select the new one
                    await loadTenants();
                    
                    // Select the newly created tenant
                    const newTenant = tenants.find(t => t.tenantId === data.tenant.tenantId);
                    if (newTenant) {
                        selectTenant(newTenant);
                        document.getElementById('tenant-select').value = newTenant.tenantId;
                    }
                } else {
                    const error = await response.json();
                    alert(`Error creating tenant: ${error.message}`);
                }
            } catch (error) {
                console.error('Error creating tenant:', error);
                alert('Error creating tenant. Please try again.');
            }
        }
        
        
        // Preview tenant configuration with specialized demo content
        function previewTenantConfig(configType) {
            const configs = {
                restaurant: {
                    title: '🍽️ Restaurant Chatbot Demo',
                    headerColor: '#f59e0b',
                    examples: [
                        'I\'d like to book a table for 4 people at 7 PM tonight',
                        'What\'s your special menu for today?',
                        'Do you have vegetarian options?',
                        'What are your opening hours?'
                    ],
                    features: 'Table reservations, menu browsing, dietary info, and location details'
                },
                clinic: {
                    title: '🏥 Medical Clinic Chatbot Demo', 
                    headerColor: '#10b981',
                    examples: [
                        'I need to schedule an appointment with Dr. Smith',
                        'What insurance do you accept?',
                        'What are your clinic hours?',
                        'Do you offer telemedicine consultations?'
                    ],
                    features: 'Appointment booking, doctor availability, insurance verification, and service information'
                },
                portfolio: {
                    title: '💼 Portfolio/Agency Chatbot Demo',
                    headerColor: '#8b5cf6',
                    examples: [
                        'I need a website for my small business',
                        'What\'s your pricing for logo design?',
                        'Can you show me some of your previous work?',
                        'How long does a typical project take?'
                    ],
                    features: 'Lead qualification, project quotes, portfolio showcase, and service inquiry'
                },
                ecommerce: {
                    title: '🛍️ E-commerce Support Chatbot Demo',
                    headerColor: '#ef4444',
                    examples: [
                        'Where is my order #12345?',
                        'I want to return this product',
                        'Do you have this item in size large?',
                        'What\'s your shipping policy?'
                    ],
                    features: 'Order tracking, return processing, product search, and customer support'
                }
            };
            
            const config = configs[configType];
            if (!config) return;
            
            // Create modal for tenant config demo
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;
            
            const previewContainer = document.createElement('div');
            previewContainer.style.cssText = `
                width: 90%;
                max-width: 800px;
                height: 80%;
                background: #f3f4f6;
                border-radius: 12px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            `;
            
            const header = document.createElement('div');
            header.style.cssText = `
                background: ${config.headerColor};
                color: white;
                padding: 1rem 2rem;
                font-family: Inter, sans-serif;
                font-weight: 600;
                font-size: 1.1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            `;
            header.innerHTML = `
                <span>${config.title}</span>
                <button onclick="this.closest('.tenant-config-modal').remove()" style="
                    background: none;
                    border: none;
                    color: white;
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: background 0.2s;
                " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">×</button>
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                padding: 2rem;
                height: calc(100% - 80px);
                background: white;
                position: relative;
                overflow-y: auto;
            `;
            
            content.innerHTML = `
                <h2 style="color: #1f2937; margin-bottom: 1rem; font-family: Inter, sans-serif;">Specialized Tenant Configuration</h2>
                <p style="color: #6b7280; font-family: Inter, sans-serif; line-height: 1.6; margin-bottom: 1.5rem;">
                    This tenant is configured with specialized features: <strong style="color: ${config.headerColor};">${config.features}</strong>
                </p>
                
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid ${config.headerColor};">
                    <h3 style="color: #1f2937; margin-bottom: 1rem; font-size: 1.1rem;">Example Customer Queries:</h3>
                    <ul style="margin-left: 1.5rem; line-height: 1.8;">
                        ${config.examples.map(example => `<li style="color: #374151; margin-bottom: 0.5rem;">"<em>${example}</em>"</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: #e0f2fe; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #0284c7;">
                    <strong>💡 How This Works:</strong> When you create a tenant with this configuration, the chatbot automatically knows how to handle these specific business needs. You can customize the responses, integrate with booking systems, and train the AI on your specific business data.
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="this.closest('.tenant-config-modal').remove()" style="
                        background: linear-gradient(135deg, ${config.headerColor}, ${config.headerColor}dd);
                        color: white;
                        border: none;
                        padding: 0.75rem 2rem;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        font-family: Inter, sans-serif;
                    ">Got It! Create My Tenant</button>
                </div>
            `;
            
            previewContainer.appendChild(header);
            previewContainer.appendChild(content);
            modal.appendChild(previewContainer);
            modal.className = 'tenant-config-modal';
            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // Show tenant setup guide
        function showTenantGuide() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;
            
            const guideContainer = document.createElement('div');
            guideContainer.style.cssText = `
                width: 90%;
                max-width: 700px;
                height: 80%;
                background: white;
                border-radius: 12px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            `;
            
            const header = document.createElement('div');
            header.style.cssText = `
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 1rem 2rem;
                font-family: Inter, sans-serif;
                font-weight: 600;
                font-size: 1.1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            `;
            header.innerHTML = `
                <span>💡 Tenant Setup Guide</span>
                <button onclick="this.closest('.tenant-guide-modal').remove()" style="
                    background: none;
                    border: none;
                    color: white;
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: background 0.2s;
                " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">×</button>
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                padding: 2rem;
                height: calc(100% - 80px);
                overflow-y: auto;
                line-height: 1.6;
            `;
            
            content.innerHTML = `
                <h2 style="color: #1f2937; margin-bottom: 1rem;">Setting Up Your Specialized Tenant</h2>
                
                <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #0284c7;">
                    <h3 style="color: #0284c7; margin-bottom: 1rem;">Step 1: Create Your Tenant</h3>
                    <p>Click "Create New Tenant" and give it a descriptive name like "Mario's Pizza" or "Downtown Dental Clinic".</p>
                </div>
                
                <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #10b981;">
                    <h3 style="color: #059669; margin-bottom: 1rem;">Step 2: Configure Specialized Features</h3>
                    <p>In your dashboard, you can enable specific features for each tenant:</p>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>🍽️ <strong>Restaurants:</strong> Menu display, reservation system, dietary filters</li>
                        <li>🏥 <strong>Medical:</strong> Appointment booking, doctor schedules, insurance info</li>
                        <li>💼 <strong>Services:</strong> Portfolio showcase, project quotes, lead forms</li>
                        <li>🛍️ <strong>E-commerce:</strong> Order tracking, product search, return processing</li>
                    </ul>
                </div>
                
                <div style="background: #fef3c7; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #f59e0b;">
                    <h3 style="color: #d97706; margin-bottom: 1rem;">Step 3: Train Your Chatbot</h3>
                    <p>Upload business-specific information:</p>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Business hours and location</li>
                        <li>Menu, services, or product catalogs</li>
                        <li>Pricing information</li>
                        <li>FAQ documents</li>
                    </ul>
                </div>
                
                <div style="background: #ede9fe; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #8b5cf6;">
                    <h3 style="color: #7c3aed; margin-bottom: 1rem;">Step 4: Integrate & Test</h3>
                    <p>Use the tenant-specific integration code and test with the specialized queries your customers will ask.</p>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="this.closest('.tenant-guide-modal').remove()" style="
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border: none;
                        padding: 0.75rem 2rem;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        font-family: Inter, sans-serif;
                    ">Start Creating My Tenant</button>
                </div>
            `;
            
            guideContainer.appendChild(header);
            guideContainer.appendChild(content);
            modal.appendChild(guideContainer);
            modal.className = 'tenant-guide-modal';
            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // Helper function to get tenant color based on type
        function getTenantColor(tenantType) {
            const colorMap = {
                'restaurant': '#f59e0b',
                'clinic': '#10b981',
                'portfolio': '#8b5cf6',
                'agency': '#8b5cf6',
                'ecommerce': '#ef4444',
                'client': '#667eea',
                'default': '#667eea'
            };
            return colorMap[tenantType] || colorMap['default'];
        }
        
        // Helper function to generate tenant-specific preview content
        function generateTenantPreviewContent(tenant) {
            if (!tenant) {
                return `
                    <h1 style="color: #1f2937; margin-bottom: 1rem; font-family: Inter, sans-serif;">Welcome to Your Website</h1>
                    <p style="color: #6b7280; font-family: Inter, sans-serif; line-height: 1.6;">This is a preview of how your chatbot widget will appear on your website. The widget will be positioned in the bottom-right corner and visitors can click it to start a conversation.</p>
                    <br>
                    <p style="color: #6b7280; font-family: Inter, sans-serif; line-height: 1.6;">Try clicking the chat bubble to see the widget in action!</p>
                    
                    <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid #667eea;">
                        <h3 style="color: #1f2937; margin-bottom: 1rem;">💬 Basic Chatbot Features:</h3>
                        <ul style="margin-left: 1.5rem; color: #374151; line-height: 1.8;">
                            <li>General conversation capabilities</li>
                            <li>FAQ responses</li>
                            <li>Contact information</li>
                            <li>Basic business information</li>
                        </ul>
                    </div>
                `;
            }
            
            const tenantType = tenant.type;
            const tenantColor = getTenantColor(tenantType);
            
            const tenantConfigs = {
                restaurant: {
                    businessName: 'Mario\'s Italian Restaurant',
                    features: [
                        'Table reservation system',
                        'Menu browsing with dietary filters',
                        'Daily specials and promotions',
                        'Hours and location information',
                        'Online ordering capabilities'
                    ],
                    sampleQueries: [
                        '"I\'d like to book a table for 4 people tonight"',
                        '"What vegetarian options do you have?"',
                        '"What time do you close on Sundays?"',
                        '"Can I see today\'s specials?"'
                    ]
                },
                clinic: {
                    businessName: 'Downtown Medical Clinic',
                    features: [
                        'Appointment scheduling system',
                        'Doctor availability checking',
                        'Insurance verification',
                        'Service information',
                        'Patient portal integration'
                    ],
                    sampleQueries: [
                        '"I need to book an appointment with Dr. Johnson"',
                        '"Do you accept Blue Cross insurance?"',
                        '"What are your clinic hours?"',
                        '"Do you offer telemedicine consultations?"'
                    ]
                },
                portfolio: {
                    businessName: 'Creative Design Agency',
                    features: [
                        'Lead qualification system',
                        'Project quote calculator',
                        'Portfolio showcase',
                        'Service inquiry handling',
                        'Contact form integration'
                    ],
                    sampleQueries: [
                        '"I need a website for my business"',
                        '"What\'s your pricing for logo design?"',
                        '"Can you show me examples of your work?"',
                        '"How long does a typical project take?"'
                    ]
                },
                agency: {
                    businessName: 'Creative Design Agency',
                    features: [
                        'Lead qualification system',
                        'Project quote calculator',
                        'Portfolio showcase',
                        'Service inquiry handling',
                        'Contact form integration'
                    ],
                    sampleQueries: [
                        '"I need a website for my business"',
                        '"What\'s your pricing for logo design?"',
                        '"Can you show me examples of your work?"',
                        '"How long does a typical project take?"'
                    ]
                },
                ecommerce: {
                    businessName: 'Online Store',
                    features: [
                        'Order tracking system',
                        'Product search and recommendations',
                        'Return and refund processing',
                        'Customer support tickets',
                        'Inventory inquiries'
                    ],
                    sampleQueries: [
                        '"Where is my order #12345?"',
                        '"I want to return this product"',
                        '"Do you have this item in size large?"',
                        '"What\'s your shipping policy?"'
                    ]
                }
            };
            
            const config = tenantConfigs[tenantType] || {
                businessName: tenant.name,
                features: [
                    'Custom chatbot responses',
                    'Business information',
                    'Contact handling',
                    'FAQ management',
                    'Lead generation'
                ],
                sampleQueries: [
                    '"What services do you offer?"',
                    '"How can I contact you?"',
                    '"What are your business hours?"',
                    '"Tell me more about your company"'
                ]
            };
            
            return `
                <h1 style="color: #1f2937; margin-bottom: 1rem; font-family: Inter, sans-serif;">Welcome to ${config.businessName}</h1>
                <p style="color: #6b7280; font-family: Inter, sans-serif; line-height: 1.6; margin-bottom: 1rem;">This tenant-specific chatbot is configured with specialized features for ${tenantType} businesses. The AI assistant understands your business context and can handle specialized queries.</p>
                
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid ${tenantColor};">
                    <h3 style="color: #1f2937; margin-bottom: 1rem;">🎯 Tenant-Specific Features:</h3>
                    <ul style="margin-left: 1.5rem; color: #374151; line-height: 1.8;">
                        ${config.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: linear-gradient(135deg, ${tenantColor}15, ${tenantColor}08); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid ${tenantColor};">
                    <h3 style="color: #1f2937; margin-bottom: 1rem;">💬 Try These Sample Queries:</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        ${config.sampleQueries.map(query => `
                            <div style="background: white; padding: 0.75rem 1rem; border-radius: 6px; color: #374151; font-style: italic; border: 1px solid ${tenantColor}30;">
                                ${query}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="background: #e0f2fe; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #0284c7;">
                    <strong>💡 Tenant ID:</strong> <code style="background: #f1f5f9; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace;">${tenant.tenantId}</code><br>
                    <small style="color: #64748b;">This tenant configuration will be used when customers interact with your chatbot on this website.</small>
                </div>
            `;
        }
        
        // Helper function to show no tenants message
        function showNoTenantsMessage() {
            const tenantSelect = document.getElementById('tenant-select');
            tenantSelect.innerHTML = '<option value="">No tenants found - Create your first tenant!</option>';
            
            // Hide tenant info section
            document.getElementById('selected-tenant-info').style.display = 'none';
            
            // Show helpful message
            const tenantControls = document.querySelector('.tenant-controls');
            const helpMessage = document.createElement('div');
            helpMessage.id = 'no-tenants-message';
            helpMessage.style.cssText = `
                background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
                border: 1px solid #0284c7;
                border-radius: 8px;
                padding: 1rem;
                margin-top: 1rem;
                text-align: center;
            `;
            helpMessage.innerHTML = `
                <div style="color: #0369a1; font-weight: 600; margin-bottom: 0.5rem;">
                    <i class="fas fa-lightbulb" style="margin-right: 0.5rem;"></i>
                    Ready to Get Started?
                </div>
                <p style="color: #0c4a6e; margin-bottom: 1rem;">Create your first tenant to enable specialized chatbot features for your website or clients.</p>
                <p style="color: #0c4a6e; font-size: 0.9rem;">Click the "Create New Tenant" button to begin!</p>
            `;
            
            // Remove existing message if any
            const existingMessage = document.getElementById('no-tenants-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            tenantControls.parentNode.insertBefore(helpMessage, tenantControls.nextSibling);
        }
        
        // Helper function to show tenant load error
        function showTenantLoadError(message) {
            const tenantSelect = document.getElementById('tenant-select');
            tenantSelect.innerHTML = '<option value="">Error loading tenants</option>';
            
            // Show error message
            const tenantControls = document.querySelector('.tenant-controls');
            const errorMessage = document.createElement('div');
            errorMessage.id = 'tenant-error-message';
            errorMessage.style.cssText = `
                background: linear-gradient(135deg, #fef2f2 0%, #fff5f5 100%);
                border: 1px solid #ef4444;
                border-radius: 8px;
                padding: 1rem;
                margin-top: 1rem;
                text-align: center;
            `;
            errorMessage.innerHTML = `
                <div style="color: #dc2626; font-weight: 600; margin-bottom: 0.5rem;">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
                    Unable to Load Tenants
                </div>
                <p style="color: #991b1b; margin-bottom: 1rem;">${message}</p>
                <button onclick="loadTenants()" style="
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    color: white;
                    border: none;
                    padding: 0.5rem 1rem;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                ">Try Again</button>
            `;
            
            // Remove existing error message if any
            const existingError = document.getElementById('tenant-error-message');
            if (existingError) {
                existingError.remove();
            }
            
            tenantControls.parentNode.insertBefore(errorMessage, tenantControls.nextSibling);
        }
        
        // Helper function to clear status messages
        function clearStatusMessages() {
            const noTenantsMessage = document.getElementById('no-tenants-message');
            const errorMessage = document.getElementById('tenant-error-message');
            
            if (noTenantsMessage) noTenantsMessage.remove();
            if (errorMessage) errorMessage.remove();
        }
        
        // Enhanced create new tenant with better validation
        async function createNewTenant() {
            let tenantName;
            let attempts = 0;
            const maxAttempts = 3;
            
            do {
                attempts++;
                tenantName = prompt(
                    attempts === 1 
                        ? 'Enter tenant name (e.g., "Mario\'s Restaurant", "Downtown Clinic"):' 
                        : `Please enter a descriptive business name (attempt ${attempts}/${maxAttempts}):`
                );
                
                if (!tenantName) {
                    return; // User cancelled
                }
                
                tenantName = tenantName.trim();
                
                // Validate tenant name
                const debugPatterns = [
                    /debug.*test.*tenant/i,
                    /test.*debug.*tenant/i,
                    /debug.*tenant/i,
                    /test.*tenant.*debug/i
                ];
                
                const hasDebugName = debugPatterns.some(pattern => pattern.test(tenantName));
                
                if (hasDebugName) {
                    alert('⚠️ Invalid tenant name. Please choose a descriptive business name instead of debug/test names.');
                    continue;
                }
                
                if (tenantName.length < 2) {
                    alert('⚠️ Tenant name must be at least 2 characters long.');
                    continue;
                }
                
                break;
                
            } while (attempts < maxAttempts);
            
            if (attempts >= maxAttempts) {
                alert('❌ Maximum attempts reached. Please try again later.');
                return;
            }
            
            const tenantDescription = prompt('Enter tenant description (optional):', '');
            
            // Validate description
            if (tenantDescription && /debug.*tenant.*for.*testing/i.test(tenantDescription)) {
                alert('⚠️ Please provide a meaningful description for your tenant.');
                return;
            }
            
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/tenant', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: tenantName,
                        description: tenantDescription,
                        type: 'client'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Show success message
                    const toast = document.getElementById('toast');
                    toast.querySelector('span').textContent = `Tenant "${data.tenant.name}" created successfully!`;
                    toast.classList.add('show');
                    setTimeout(() => toast.classList.remove('show'), 3000);
                    
                    // Clear any status messages
                    clearStatusMessages();
                    
                    // Reload tenants and select the new one
                    await loadTenants();
                    
                    // Select the newly created tenant
                    const newTenant = tenants.find(t => t.tenantId === data.tenant.tenantId);
                    if (newTenant) {
                        selectTenant(newTenant);
                        document.getElementById('tenant-select').value = newTenant.tenantId;
                    }
                } else {
                    const error = await response.json();
                    let errorMessage = error.message || 'Unknown error occurred';
                    
                    // Check for specific validation errors
                    if (error.details && Array.isArray(error.details)) {
                        const validationErrors = error.details.map(detail => detail.msg || detail.message).join(', ');
                        errorMessage = validationErrors;
                    }
                    
                    alert(`❌ Error creating tenant: ${errorMessage}`);
                }
            } catch (error) {
                console.error('Error creating tenant:', error);
                alert('❌ Network error creating tenant. Please check your connection and try again.');
            }
        }
        
        // Progress tracking function
        async function updateSetupProgress(step, completed = true) {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) return;
                
                const response = await fetch('/api/setup-progress', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ step, completed })
                });
                
                if (response.ok) {
                    console.log(`✅ Progress updated: ${step} = ${completed}`);
                } else {
                    console.error('Failed to update setup progress');
                }
            } catch (error) {
                console.error('Error updating setup progress:', error);
            }
        }
        
        // Add some interactive animations
        document.addEventListener('DOMContentLoaded', function() {
            // Load user data on page load
            loadUserData();
            
            // Mark embed step as started when user visits integration page
            updateSetupProgress('embed', true);
            
            // Tenant selection change handler
            document.getElementById('tenant-select').addEventListener('change', function(e) {
                const tenantId = e.target.value;
                if (tenantId) {
                    const tenant = tenants.find(t => t.tenantId === tenantId);
                    if (tenant) {
                        selectTenant(tenant);
                    }
                } else {
                    selectedTenant = null;
                    document.getElementById('selected-tenant-info').style.display = 'none';
                    updateIntegrationCode();
                }
            });
            
            // Create new tenant button handler
            document.getElementById('create-tenant-btn').addEventListener('click', createNewTenant);
            
            // Tenant filter input handler
            document.getElementById('tenant-filter').addEventListener('input', filterTenants);
            
            // Clear filter button handler
            document.getElementById('clear-filter-btn').addEventListener('click', clearFilter);
            
            const cards = document.querySelectorAll('.card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });
            
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
                observer.observe(card);
            });
        });
    </script>
</body>
</html>

