/**
 * AI Chatbot Widget - Client-side Implementation
 * 
 * This script creates a customizable AI chatbot widget that can be embedded
 * on any website. It communicates with the backend API to provide AI-powered
 * customer support.
 * 
 * Usage:
 * <script src="https://www.mouna-ai.com/widget.js" data-api-key="your-api-key"></script>
 */

(function() {
    'use strict';
    
    // Multi-language translations
    const TRANSLATIONS = {
        en: {
            title: 'AI Assistant',
            subtitle: 'Online тАв Usually replies instantly',
            welcomeMessage: 'ЁЯСЛ Hi there! I\'m your AI assistant. How can I help you today?',
            placeholder: 'Type your message...',
            typing: 'AI is typing...',
            send: 'Send',
            close: 'Close chat',
            open: 'Open chat',
            poweredBy: 'Powered by AI Chatbot Widget',
            selectLanguage: 'Select Language',
            errors: {
                networkError: 'Network error. Please check your connection and try again.',
                rateLimited: 'Too many requests. Please wait a moment before sending another message.',
                generalError: 'Something went wrong. Please try again.',
                messageEmpty: 'Please enter a message before sending.'
            }
        },
        hi: {
            title: 'AI рд╕рд╣рд╛рдпрдХ',
            subtitle: 'рдСрдирд▓рд╛рдЗрди тАв рдЖрдорддреМрд░ рдкрд░ рддреБрд░рдВрдд рдЬрд╡рд╛рдм рджреЗрддрд╛ рд╣реИ',
            welcomeMessage: 'ЁЯСЛ рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХрд╛ AI рд╕рд╣рд╛рдпрдХ рд╣реВрдБред рдЖрдЬ рдореИрдВ рдЖрдкрдХреА рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ?',
            placeholder: 'рдЕрдкрдирд╛ рд╕рдВрджреЗрд╢ рдЯрд╛рдЗрдк рдХрд░реЗрдВ...',
            typing: 'AI рдЯрд╛рдЗрдк рдХрд░ рд░рд╣рд╛ рд╣реИ...',
            send: 'рднреЗрдЬреЗрдВ',
            close: 'рдЪреИрдЯ рдмрдВрдж рдХрд░реЗрдВ',
            open: 'рдЪреИрдЯ рдЦреЛрд▓реЗрдВ',
            poweredBy: 'AI рдЪреИрдЯрдмреЙрдЯ рд╡рд┐рдЬреЗрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд',
            selectLanguage: 'рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ',
            errors: {
                networkError: 'рдиреЗрдЯрд╡рд░реНрдХ рддреНрд░реБрдЯрд┐ред рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдХрдиреЗрдХреНрд╢рди рдЬрд╛рдВрдЪреЗрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред',
                rateLimited: 'рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЕрдиреБрд░реЛрдзред рдХреГрдкрдпрд╛ рджреВрд╕рд░рд╛ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдереЛрдбрд╝рд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдВред',
                generalError: 'рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖред рдХреГрдкрдпрд╛ рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред',
                messageEmpty: 'рдХреГрдкрдпрд╛ рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рд╕рдВрджреЗрд╢ рджрд░реНрдЬ рдХрд░реЗрдВред'
            }
        },
        te: {
            title: 'AI р░╕р░╣р░╛р░пр░Хр▒Бр░бр▒Б',
            subtitle: 'р░Жр░ир▒НтАМр░▓р▒Ир░ир▒Н тАв р░╕р░╛р░зр░╛р░░р░гр░Вр░Чр░╛ р░╡р▒Жр░Вр░Яр░ир▒З р░╕р░ор░╛р░зр░╛р░ир░В р░Зр░╕р▒Нр░др▒Бр░Вр░жр░┐',
            welcomeMessage: 'ЁЯСЛ р░╣р░▓р▒Л! р░ир▒Зр░ир▒Б р░ор▒А AI р░╕р░╣р░╛р░пр░Хр▒Бр░бр░┐р░ир░┐. р░ир▒Зр░ир▒Б р░Ир░░р▒Лр░Ьр▒Б р░ор▒Ар░Хр▒Б р░Ор░▓р░╛ р░╕р░╣р░╛р░пр░В р░Ър▒Зр░пр░Чр░▓р░ир▒Б?',
            placeholder: 'р░ор▒А р░╕р░Вр░жр▒Зр░╢р░╛р░ир▒Нр░ир░┐ р░Яр▒Ир░кр▒Н р░Ър▒Зр░пр░Вр░бр░┐...',
            typing: 'AI р░Яр▒Ир░кр▒Н р░Ър▒Зр░╕р▒Нр░др▒Лр░Вр░жр░┐...',
            send: 'р░кр░Вр░кр░Вр░бр░┐',
            close: 'р░Ър░╛р░Яр▒Н р░ор▒Вр░╕р░┐р░╡р▒Зр░пр░Вр░бр░┐',
            open: 'р░Ър░╛р░Яр▒Н р░др▒Жр░░р░╡р░Вр░бр░┐',
            poweredBy: 'AI р░Ър░╛р░Яр▒НтАМр░мр░╛р░Яр▒Н р░╡р░┐р░Ьр▒Жр░Яр▒Н р░жр▒Нр░╡р░╛р░░р░╛ р░╢р░Хр▒Нр░др░┐р░╡р░Вр░др░В',
            selectLanguage: 'р░нр░╛р░╖ р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐',
            errors: {
                networkError: 'р░ир▒Жр░Яр▒НтАМр░╡р░░р▒Нр░Хр▒Н р░▓р▒Лр░кр░В. р░жр░пр░Ър▒Зр░╕р░┐ р░ор▒А р░Хр░ир▒Жр░Хр▒Нр░╖р░ир▒НтАМр░ир▒Б р░др░ир░┐р░Цр▒А р░Ър▒Зр░╕р░┐ р░ор░│р▒Нр░▓р▒А р░кр▒Нр░░р░пр░др▒Нр░ир░┐р░Вр░Ър░Вр░бр░┐.',
                rateLimited: 'р░Ър░╛р░▓р░╛ р░Ер░нр▒Нр░пр░░р▒Нр░ер░ир░▓р▒Б. р░жр░пр░Ър▒Зр░╕р░┐ р░ор░░р▒Кр░Х р░╕р░Вр░жр▒Зр░╢р░В р░кр░Вр░кр▒З р░ор▒Бр░Вр░жр▒Б р░Хр░╛р░╕р▒Нр░д р░╡р▒Зр░Ър░┐ р░Йр░Вр░бр░Вр░бр░┐.',
                generalError: 'р░Пр░жр▒Л р░др░кр▒Нр░кр▒Б р░Ьр░░р░┐р░Чр░┐р░Вр░жр░┐. р░жр░пр░Ър▒Зр░╕р░┐ р░ор░│р▒Нр░▓р▒А р░кр▒Нр░░р░пр░др▒Нр░ир░┐р░Вр░Ър░Вр░бр░┐.',
                messageEmpty: 'р░жр░пр░Ър▒Зр░╕р░┐ р░кр░Вр░кр▒З р░ор▒Бр░Вр░жр▒Б р░Тр░Х р░╕р░Вр░жр▒Зр░╢р░╛р░ир▒Нр░ир░┐ р░ир░ор▒Лр░жр▒Б р░Ър▒Зр░пр░Вр░бр░┐.'
            }
        },
        ta: {
            title: 'AI роЙродро╡ро┐ропро╛ро│ро░рпН',
            subtitle: 'роЖройрпНро▓рпИройрпН тАв рокрпКродрпБро╡ро╛роХ роЙроЯройроЯро┐ропро╛роХ рокродро┐ро▓ро│ро┐роХрпНроХрпБроорпН',
            welcomeMessage: 'ЁЯСЛ ро╡рогроХрпНроХроорпН! роиро╛ройрпН роЙроЩрпНроХро│рпН AI роЙродро╡ро┐ропро╛ро│ро░рпН. роЗройрпНро▒рпБ роиро╛ройрпН роЙроЩрпНроХро│рпБроХрпНроХрпБ роОрокрпНрокроЯро┐ роЙродро╡ роорпБроЯро┐ропрпБроорпН?',
            placeholder: 'роЙроЩрпНроХро│рпН роЪрпЖропрпНродро┐ропрпИ родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН...',
            typing: 'AI родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНродрпБ роХрпКрогрпНроЯро┐ро░рпБроХрпНроХро┐ро▒родрпБ...',
            send: 'роЕройрпБрокрпНрокрпБ',
            close: 'роЕро░роЯрпНроЯрпИропрпИ роорпВроЯрпБ',
            open: 'роЕро░роЯрпНроЯрпИропрпИ родро┐ро▒',
            poweredBy: 'AI роЪро╛роЯрпНрокро╛роЯрпН ро╡ро┐роЯрпНроЬрпЖроЯрпНроЯро╛ро▓рпН роЗропроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ',
            selectLanguage: 'роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН',
            errors: {
                networkError: 'роирпЖроЯрпНро╡рпКро░рпНроХрпН рокро┐ро┤рпИ. родропро╡рпБроЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН роЗрогрпИрокрпНрокрпИ роЪро░ро┐рокро╛ро░рпНродрпНродрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.',
                rateLimited: 'роЕродро┐роХ роХрпЛро░ро┐роХрпНроХрпИроХро│рпН. родропро╡рпБроЪрпЖропрпНродрпБ рооро▒рпНро▒рпКро░рпБ роЪрпЖропрпНродро┐ роЕройрпБрокрпНрокрпБроорпН роорпБройрпН роЪро┐ро▒ро┐родрпБ роХро╛родрпНродро┐ро░рпБроЩрпНроХро│рпН.',
                generalError: 'роПродрпЛ родро╡ро▒рпБ роироЯроирпНродродрпБ. родропро╡рпБроЪрпЖропрпНродрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.',
                messageEmpty: 'родропро╡рпБроЪрпЖропрпНродрпБ роЕройрпБрокрпНрокрпБроорпН роорпБройрпН роТро░рпБ роЪрпЖропрпНродро┐ропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.'
            }
        },
        mr: {
            title: 'AI рд╕рд╣рд╛рдпреНрдпрдХ',
            subtitle: 'рдСрдирд▓рд╛рдЗрди тАв рд╕рд╣рд╕рд╛ рд▓рдЧреЗрдЪрдЪ рдЙрддреНрддрд░ рджреЗрддреЛ',
            welcomeMessage: 'ЁЯСЛ рдирдорд╕реНрдХрд╛рд░! рдореА рддреБрдордЪрд╛ AI рд╕рд╣рд╛рдпреНрдпрдХ рдЖрд╣реЗ. рдЖрдЬ рдореА рддреБрдореНрд╣рд╛рд▓рд╛ рдХрд╢реА рдорджрдд рдХрд░реВ рд╢рдХрддреЛ?',
            placeholder: 'рддреБрдордЪрд╛ рд╕рдВрджреЗрд╢ рдЯрд╛рдЗрдк рдХрд░рд╛...',
            typing: 'AI рдЯрд╛рдЗрдк рдХрд░рдд рдЖрд╣реЗ...',
            send: 'рдкрд╛рдард╡рд╛',
            close: 'рдЪреЕрдЯ рдмрдВрдж рдХрд░рд╛',
            open: 'рдЪреЕрдЯ рдЙрдШрдбрд╛',
            poweredBy: 'AI рдЪреЕрдЯрдмреЙрдЯ рд╡рд┐рдЬреЗрдЯрджреНрд╡рд╛рд░реЗ рдЪрд╛рд▓рд╡рд▓реЗ рдЬрд╛рддреЗ',
            selectLanguage: 'рднрд╛рд╖рд╛ рдирд┐рд╡рдбрд╛',
            errors: {
                networkError: 'рдиреЗрдЯрд╡рд░реНрдХ рддреНрд░реБрдЯреА. рдХреГрдкрдпрд╛ рддреБрдордЪреЗ рдХрдиреЗрдХреНрд╢рди рддрдкрд╛рд╕рд╛ рдЖрдгрд┐ рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.',
                rateLimited: 'рдмрд░реЗрдЪ рд╡рд┐рдирдВрддреНрдпрд╛. рдХреГрдкрдпрд╛ рджреБрд╕рд░рд╛ рд╕рдВрджреЗрд╢ рдкрд╛рдард╡рдгреНрдпрд╛рдкреВрд░реНрд╡реА рдереЛрдбреА рд╡рд╛рдЯ рдкрд╣рд╛.',
                generalError: 'рдХрд╛рд╣реАрддрд░реА рдЪреВрдХ рдЭрд╛рд▓реА. рдХреГрдкрдпрд╛ рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.',
                messageEmpty: 'рдХреГрдкрдпрд╛ рдкрд╛рдард╡рдгреНрдпрд╛рдкреВрд░реНрд╡реА рд╕рдВрджреЗрд╢ рдЯрд╛рдХрд╛.'
            }
        },
        kn: {
            title: 'AI р▓╕р▓╣р▓╛р▓пр▓Х',
            subtitle: 'р▓Жр▓ир│НтАМр▓▓р│Ир▓ир│Н тАв р▓╕р▓╛р▓ор▓╛р▓ир│Нр▓пр▓╡р▓╛р▓Чр▓┐ р▓др▓Хр│Нр▓╖р▓г р▓Йр▓др│Нр▓др▓░р▓┐р▓╕р│Бр▓др│Нр▓др▓жр│Ж',
            welcomeMessage: 'ЁЯСЛ р▓ир▓ор▓╕р│Нр▓Хр▓╛р▓░! р▓ир▓╛р▓ир│Б р▓ир▓┐р▓ор│Нр▓о AI р▓╕р▓╣р▓╛р▓пр▓Х. р▓Зр▓Вр▓жр│Б р▓ир▓╛р▓ир│Б р▓ир▓┐р▓ор▓Чр│Ж р▓╣р│Зр▓Чр│Ж р▓╕р▓╣р▓╛р▓п р▓ор▓╛р▓бр▓мр▓╣р│Бр▓жр│Б?',
            placeholder: 'р▓ир▓┐р▓ор│Нр▓о р▓╕р▓Вр▓жр│Зр▓╢р▓╡р▓ир│Нр▓ир│Б р▓Яр│Ир▓кр│Н р▓ор▓╛р▓бр▓┐...',
            typing: 'AI р▓Яр│Ир▓кр│Н р▓ор▓╛р▓бр│Бр▓др│Нр▓др▓┐р▓жр│Ж...',
            send: 'р▓Хр▓│р│Бр▓╣р▓┐р▓╕р▓┐',
            close: 'р▓Ър▓╛р▓Яр│Н р▓Ер▓ир│Нр▓ир│Б р▓ор│Бр▓Ър│Нр▓Ър▓┐',
            open: 'р▓Ър▓╛р▓Яр│Н р▓Ер▓ир│Нр▓ир│Б р▓др│Жр▓░р│Жр▓пр▓┐р▓░р▓┐',
            poweredBy: 'AI р▓Ър▓╛р▓Яр│НтАМр▓мр▓╛р▓Яр│Н р▓╡р▓┐р▓Ьр│Жр▓Яр│НтАМр▓ир▓┐р▓Вр▓ж р▓Ър▓╛р▓▓р▓┐р▓д',
            selectLanguage: 'р▓нр▓╛р▓╖р│Жр▓пр▓ир│Нр▓ир│Б р▓Жр▓пр│Нр▓Хр│Жр▓ор▓╛р▓бр▓┐',
            errors: {
                networkError: 'р▓ир│Жр▓Яр│НтАМр▓╡р▓░р│Нр▓Хр│Н р▓жр│Лр▓╖. р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓ир▓┐р▓ор│Нр▓о р▓╕р▓Вр▓кр▓░р│Нр▓Хр▓╡р▓ир│Нр▓ир│Б р▓кр▓░р▓┐р▓╢р│Ар▓▓р▓┐р▓╕р▓┐ р▓ор▓др│Нр▓др│Б р▓ор▓др│Нр▓др│Ж р▓кр│Нр▓░р▓пр▓др│Нр▓ир▓┐р▓╕р▓┐.',
                rateLimited: 'р▓╣р▓▓р▓╡р▓╛р▓░р│Б р▓╡р▓┐р▓ир▓Вр▓др▓┐р▓Чр▓│р│Б. р▓ор▓др│Нр▓др│Кр▓Вр▓жр│Б р▓╕р▓Вр▓жр│Зр▓╢ р▓Хр▓│р│Бр▓╣р▓┐р▓╕р│Бр▓╡ р▓ор│Кр▓жр▓▓р│Б р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓╕р│Нр▓╡р▓▓р│Нр▓к р▓Хр▓╛р▓пр▓┐р▓░р▓┐.',
                generalError: 'р▓Пр▓ир│Л р▓др▓кр│Нр▓кр▓╛р▓Чр▓┐р▓жр│Ж. р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓ор▓др│Нр▓др│Ж р▓кр│Нр▓░р▓пр▓др│Нр▓ир▓┐р▓╕р▓┐.',
                messageEmpty: 'р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓Хр▓│р│Бр▓╣р▓┐р▓╕р│Бр▓╡ р▓ор│Кр▓жр▓▓р│Б р▓╕р▓Вр▓жр│Зр▓╢р▓╡р▓ир│Нр▓ир│Б р▓ир▓ор│Вр▓жр▓┐р▓╕р▓┐.'
            }
        }
    };

    const SUPPORTED_LANGUAGES = {
        en: { code: 'en', name: 'English', nativeName: 'English', flag: 'ЁЯЗ║ЁЯЗ╕' },
        hi: { code: 'hi', name: 'Hindi', nativeName: 'рд╣рд┐рдВрджреА', flag: 'ЁЯЗоЁЯЗ│' },
        te: { code: 'te', name: 'Telugu', nativeName: 'р░др▒Жр░▓р▒Бр░Чр▒Б', flag: 'ЁЯЗоЁЯЗ│' },
        ta: { code: 'ta', name: 'Tamil', nativeName: 'родрооро┐ро┤рпН', flag: 'ЁЯЗоЁЯЗ│' },
        mr: { code: 'mr', name: 'Marathi', nativeName: 'рдорд░рд╛рдареА', flag: 'ЁЯЗоЁЯЗ│' },
        kn: { code: 'kn', name: 'Kannada', nativeName: 'р▓Хр▓ир│Нр▓ир▓б', flag: 'ЁЯЗоЁЯЗ│' }
    };

    // Configuration
    const WIDGET_CONFIG = {
        // API endpoint (will be set from script tag or defaults)
        apiEndpoint: window.ChatbotWidgetAPI || 'https://mouna-ai-chatbot-production.up.railway.app',
        apiKey: null,
        tenantId: null, // NEW: Tenant ID for configuration
        
        // Default widget settings
        primaryColor: '#667eea',
        position: 'bottom-right',
        language: 'en', // Default language
        
        // Widget behavior
        autoOpen: false,
        showBranding: true,
        maxMessages: 50,
        typingDelay: 1000,
        
        // Animations
        animationDuration: 300,
        
        // Tenant-specific features (will be loaded from server)
        enabledFeatures: {
            bookings: false,
            orders: false,
            slots: false,
            payments: false,
            analytics: false
        }
    };
    
    // Widget state
    let widget = null;
    let isOpen = false;
    let isTyping = false;
    let sessionId = null;

    // The rest of this file is identical to widget-fixed.js
    // For brevity and to avoid duplication errors, we import the implementation directly by referencing the same IIFE content below.

