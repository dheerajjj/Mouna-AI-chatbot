<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Chat - Mouna AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0d7b8a 0%, #4a0e6b 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1a202c;
            line-height: 1.6;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1.5rem 0;
            position: relative;
            z-index: 10;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo img {
            width: 40px;
            height: 40px;
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }
        
        .logo-name {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e293b;
            letter-spacing: -0.02em;
        }
        
        .logo-tagline {
            font-size: 0.75rem;
            font-weight: 500;
            color: #64748b;
            letter-spacing: 0.02em;
            margin-top: -2px;
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e293b;
        }
        
        .user-name {
            font-weight: 500;
        }
        
        .back-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #dc2626;
        }
        
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .configuration-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        .settings-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .preview-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 2rem;
        }
        
        .section {
            margin-bottom: 2rem;
        }
        
        .section h3 {
            margin-bottom: 1rem;
            color: #1e293b;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .preset-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .preset-option {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .preset-option.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .preset-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }
        
        .preset-description {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
            width: 100%;
            margin-top: 1rem;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .chat-preview {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1rem;
            min-height: 400px;
            border: 1px solid #e5e7eb;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .chat-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .chat-message {
            display: flex;
            gap: 0.5rem;
        }
        
        .message-bubble {
            background: white;
            padding: 0.75rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            max-width: 80%;
            font-size: 0.9rem;
        }
        
        .user-message {
            flex-direction: row-reverse;
        }
        
        .user-message .message-bubble {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .upgrade-banner {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .feature-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .feature-icon {
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .configuration-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .preview-panel {
                position: static;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="/images/logo.png" alt="Mouna AI Logo">
                <div class="logo-text">
                    <div class="logo-name">Mouna</div>
                    <div class="logo-tagline">AI ASSISTANT</div>
                </div>
            </div>
            <div class="nav-actions">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span class="user-name" id="user-name">Loading...</span>
                </div>
                <a href="/welcome-dashboard" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🤖 Configure Chat Behavior</h1>
            <p>Customize how your AI assistant interacts with visitors</p>
        </div>

        <!-- Upgrade Banner for Free Users -->
        <div class="upgrade-banner" id="upgrade-banner" style="display: none;">
            <h3>🔒 Premium Feature</h3>
            <p>Advanced chat configuration is available for paid plan users. Upgrade to unlock custom prompts and AI behavior settings!</p>
            <button class="btn" onclick="window.location.href='/pricing'" style="background: white; color: #f59e0b; margin-top: 1rem; max-width: 200px; margin-left: auto; margin-right: auto;">
                Upgrade Now
            </button>
        </div>

        <div class="configuration-grid">
            <!-- Settings Panel -->
            <div class="settings-panel">
                <div class="section">
                    <h3><i class="fas fa-brain"></i> AI Personality</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Choose a Personality Preset</label>
                        <div class="preset-group">
                            <div class="preset-option active" data-preset="professional">
                                <div class="preset-title">Professional</div>
                                <div class="preset-description">Formal, helpful, and business-focused</div>
                            </div>
                            <div class="preset-option" data-preset="friendly">
                                <div class="preset-title">Friendly</div>
                                <div class="preset-description">Warm, casual, and conversational</div>
                            </div>
                            <div class="preset-option" data-preset="expert">
                                <div class="preset-title">Expert</div>
                                <div class="preset-description">Technical, detailed, and informative</div>
                            </div>
                            <div class="preset-option" data-preset="custom">
                                <div class="preset-title">Custom</div>
                                <div class="preset-description">Create your own unique personality</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3><i class="fas fa-comment-dots"></i> Custom Instructions</h3>
                    
                    <div class="form-group">
                        <label class="form-label">System Prompt</label>
                        <textarea id="system-prompt" class="form-input form-textarea" placeholder="You are a helpful AI assistant for [Your Company]. You should...">You are a helpful AI assistant. Be professional, concise, and always try to provide accurate information. If you don't know something, say so honestly.</textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Welcome Message</label>
                        <input type="text" id="welcome-msg" class="form-input" value="Hello! How can I help you today?" placeholder="Enter welcome message">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Fallback Response</label>
                        <textarea id="fallback-response" class="form-input" rows="3" placeholder="Message when AI can't answer">I'm sorry, I don't have enough information to answer that question accurately. Would you like me to connect you with a human agent?</textarea>
                    </div>
                </div>

                <div class="section">
                    <h3><i class="fas fa-cogs"></i> Behavior Settings</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Response Length</label>
                        <select id="response-length" class="form-input">
                            <option value="short">Short (1-2 sentences)</option>
                            <option value="medium" selected>Medium (2-4 sentences)</option>
                            <option value="long">Long (Detailed explanations)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Language Style</label>
                        <select id="language-style" class="form-input">
                            <option value="formal">Formal</option>
                            <option value="casual" selected>Casual</option>
                            <option value="technical">Technical</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Topics to Focus On</label>
                        <input type="text" id="focus-topics" class="form-input" placeholder="e.g., product support, pricing, features" value="general support, product information">
                    </div>
                </div>

                <button class="btn" onclick="saveConfiguration()">
                    <i class="fas fa-save"></i>
                    Save Configuration
                </button>
            </div>

            <!-- Preview Panel -->
            <div class="preview-panel">
                <h3 style="margin-bottom: 1rem; color: #1e293b;">Chat Preview</h3>
                <p style="color: #64748b; margin-bottom: 1.5rem; font-size: 0.9rem;">See how your AI will interact with users</p>
                
                <div class="chat-preview">
                    <div class="chat-header">
                        <div class="chat-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Mouna AI</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Online</div>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message">
                            <div class="chat-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-bubble" id="preview-welcome">
                                Hello! How can I help you today?
                            </div>
                        </div>
                        
                        <div class="chat-message user-message">
                            <div class="message-bubble">
                                What are your business hours?
                            </div>
                        </div>
                        
                        <div class="chat-message">
                            <div class="chat-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-bubble" id="preview-response">
                                I'd be happy to help you with information about our business hours. We're open Monday through Friday from 9 AM to 6 PM EST.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; color: #1e293b; font-size: 0.9rem;">Advanced Features</h4>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <i class="fas fa-language feature-icon"></i>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Multi-language</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Support 50+ languages</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-chart-line feature-icon"></i>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Analytics</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Track conversation metrics</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-users feature-icon"></i>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Human Handoff</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Seamless agent transfer</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-database feature-icon"></i>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Knowledge Base</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Custom training data</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check user's plan and show/hide upgrade banner
        document.addEventListener('DOMContentLoaded', function() {
            checkUserPlan();
            initializeConfiguration();
        });

        async function checkUserPlan() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    window.location.href = '/login';
                    return;
                }

                const response = await fetch('/api/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const { user } = await response.json();
                    
                    // Update user name in navigation
                    document.getElementById('user-name').textContent = user.name;
                    
                    const userPlan = user.subscription?.plan || 'free';
                    
                    if (userPlan === 'free') {
                        document.getElementById('upgrade-banner').style.display = 'block';
                        // Disable inputs for free users
                        disableConfigurationForFreeUsers();
                    } else {
                        // Load existing configuration for premium users
                        await loadExistingConfiguration();
                    }
                } else {
                    // If unauthorized, redirect to login
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Error checking user plan:', error);
                // On error, redirect to login
                window.location.href = '/login';
            }
        }

        async function loadExistingConfiguration() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    console.warn('No token available for loading configuration');
                    return;
                }

                const response = await fetch('/api/chat-config', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const { configuration } = await response.json();
                    console.log('✅ Loaded existing configuration:', configuration);
                    
                    // Populate form fields with existing configuration
                    if (configuration.preset) {
                        // Update active preset
                        document.querySelectorAll('.preset-option').forEach(opt => opt.classList.remove('active'));
                        const activePreset = document.querySelector(`[data-preset="${configuration.preset}"]`);
                        if (activePreset) {
                            activePreset.classList.add('active');
                        }
                    }
                    
                    if (configuration.systemPrompt) {
                        document.getElementById('system-prompt').value = configuration.systemPrompt;
                    }
                    
                    if (configuration.welcomeMessage) {
                        document.getElementById('welcome-msg').value = configuration.welcomeMessage;
                    }
                    
                    if (configuration.fallbackResponse) {
                        document.getElementById('fallback-response').value = configuration.fallbackResponse;
                    }
                    
                    if (configuration.responseLength) {
                        document.getElementById('response-length').value = configuration.responseLength;
                    }
                    
                    if (configuration.languageStyle) {
                        document.getElementById('language-style').value = configuration.languageStyle;
                    }
                    
                    if (configuration.focusTopics) {
                        document.getElementById('focus-topics').value = configuration.focusTopics;
                    }
                    
                    // Update preview with loaded configuration
                    updatePreview();
                } else {
                    console.warn('Failed to load configuration, using defaults');
                }
            } catch (error) {
                console.error('Error loading existing configuration:', error);
                // Continue with default values if loading fails
            }
        }

        function disableConfigurationForFreeUsers() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.disabled = true;
                input.style.opacity = '0.6';
            });

            const presetOptions = document.querySelectorAll('.preset-option');
            presetOptions.forEach(option => {
                option.style.pointerEvents = 'none';
                option.style.opacity = '0.6';
            });
        }

        function initializeConfiguration() {
            // Preset selector
            document.querySelectorAll('.preset-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.preset-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    applyPreset(this.dataset.preset);
                    updatePreview();
                });
            });

            // Input event listeners
            document.getElementById('system-prompt').addEventListener('input', updatePreview);
            document.getElementById('welcome-msg').addEventListener('input', updatePreview);
            document.getElementById('fallback-response').addEventListener('input', updatePreview);
            document.getElementById('response-length').addEventListener('change', updatePreview);
            document.getElementById('language-style').addEventListener('change', updatePreview);
            document.getElementById('focus-topics').addEventListener('input', updatePreview);

            updatePreview();
        }

        function applyPreset(preset) {
            const systemPrompt = document.getElementById('system-prompt');
            const welcomeMsg = document.getElementById('welcome-msg');
            
            switch(preset) {
                case 'professional':
                    systemPrompt.value = "You are a professional AI assistant representing our company. Provide accurate, helpful information in a formal, business-appropriate tone. Always be courteous and maintain professionalism.";
                    welcomeMsg.value = "Good day! How may I assist you today?";
                    document.getElementById('language-style').value = 'formal';
                    break;
                    
                case 'friendly':
                    systemPrompt.value = "You are a friendly and approachable AI assistant. Be warm, helpful, and conversational. Use a casual tone while remaining professional and informative.";
                    welcomeMsg.value = "Hi there! I'm here to help. What can I do for you?";
                    document.getElementById('language-style').value = 'casual';
                    break;
                    
                case 'expert':
                    systemPrompt.value = "You are an expert AI assistant with deep technical knowledge. Provide detailed, accurate information with technical precision. Be thorough in your explanations and cite relevant details when possible.";
                    welcomeMsg.value = "Hello! I'm your technical assistant. What would you like to know?";
                    document.getElementById('language-style').value = 'technical';
                    break;
                    
                case 'custom':
                    // Keep current values for custom
                    break;
            }
        }

        function updatePreview() {
            const welcomeMsg = document.getElementById('welcome-msg').value;
            const responseLength = document.getElementById('response-length').value;
            const languageStyle = document.getElementById('language-style').value;
            
            // Update welcome message
            document.getElementById('preview-welcome').textContent = welcomeMsg;
            
            // Update response based on settings
            let sampleResponse = generateSampleResponse(responseLength, languageStyle);
            document.getElementById('preview-response').textContent = sampleResponse;
        }

        function generateSampleResponse(length, style) {
            const responses = {
                short: {
                    formal: "Our business hours are Monday through Friday, 9 AM to 6 PM EST.",
                    casual: "We're open Monday-Friday, 9 AM to 6 PM EST!",
                    technical: "Operating hours: Mon-Fri 09:00-18:00 EST (UTC-5)."
                },
                medium: {
                    formal: "I'd be happy to provide information about our business hours. We operate Monday through Friday from 9 AM to 6 PM Eastern Standard Time. Please feel free to contact us during these hours.",
                    casual: "I'd be happy to help! We're open Monday through Friday from 9 AM to 6 PM EST. Feel free to reach out anytime during those hours.",
                    technical: "Our operational schedule is Monday through Friday, 09:00-18:00 EST (Eastern Standard Time, UTC-5). Support and services are available during these designated business hours."
                },
                long: {
                    formal: "Thank you for your inquiry regarding our business hours. Our organization operates Monday through Friday from 9:00 AM to 6:00 PM Eastern Standard Time. During these hours, our full team is available to assist with inquiries, support requests, and general assistance. Outside of these hours, you may still submit requests through our contact forms, and we will respond during the next business day.",
                    casual: "Great question! We're open Monday through Friday from 9 AM to 6 PM EST. During these hours, our awesome team is here to help with whatever you need. If you reach out outside these times, don't worry - just send us a message and we'll get back to you first thing the next business day!",
                    technical: "Our operational parameters are as follows: Business hours are Monday through Friday, 09:00-18:00 EST (UTC-5). During this timeframe, all systems are fully operational with complete staff availability for technical support, customer service, and general inquiries. After-hours submissions are queued for processing during the next available business period."
                }
            };
            
            return responses[length][style];
        }

        async function saveConfiguration() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    alert('Please log in to save configuration');
                    return;
                }

                const configuration = {
                    preset: document.querySelector('.preset-option.active').dataset.preset,
                    systemPrompt: document.getElementById('system-prompt').value,
                    welcomeMessage: document.getElementById('welcome-msg').value,
                    fallbackResponse: document.getElementById('fallback-response').value,
                    responseLength: document.getElementById('response-length').value,
                    languageStyle: document.getElementById('language-style').value,
                    focusTopics: document.getElementById('focus-topics').value
                };

                const response = await fetch('/api/chat-config', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(configuration)
                });

                if (response.ok) {
                    alert('🎉 Chat configuration saved successfully!');
                    
                    // Mark customize step as completed in progress
                    await updateSetupProgress('customize', true);
                } else {
                    throw new Error('Failed to save configuration');
                }
            } catch (error) {
                console.error('Error saving configuration:', error);
                alert('Error saving configuration. Please try again.');
            }
        }
        
        // Progress tracking function
        async function updateSetupProgress(step, completed = true) {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) return;
                
                const response = await fetch('/api/setup-progress', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ step, completed })
                });
                
                if (response.ok) {
                    console.log(`✅ Progress updated: ${step} = ${completed}`);
                } else {
                    console.error('Failed to update setup progress');
                }
            } catch (error) {
                console.error('Error updating setup progress:', error);
            }
        }
        
        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            window.location.href = '/login';
        }
    </script>
</body>
</html>
